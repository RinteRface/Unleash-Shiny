<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Unleash Shiny</title>
    <meta charset="utf-8" />
    <meta name="author" content="David Granjon (Novartis) &amp; John Coene (World Economic Forum)" />
    <link href="libs/tile-view-0.2.3.9000/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.3.9000/tile-view.js"></script>
    <link href="libs/animate.css-3.7.2/animate.xaringan.css" rel="stylesheet" />
    <link href="libs/tachyons-4.12.0/tachyons.min.css" rel="stylesheet" />
    <link href="libs/xaringanExtra-extra-styles-0.2.3.9000/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <link href="libs/js4shiny-0.0.28/css/_variables-fonts.css" rel="stylesheet" />
    <link href="libs/js4shiny-0.0.28/css/_variables.css" rel="stylesheet" />
    <link href="libs/js4shiny-0.0.28/css/code.css" rel="stylesheet" />
    <link href="libs/js4shiny-0.0.28/jsonview/jsonview.css" rel="stylesheet" />
    <script src="libs/js4shiny-0.0.28/jsonview/jsonview.min.js"></script>
    <link href="libs/js4shiny-redirectConsoleLog-0.0.28/jslog.css" rel="stylesheet" />
    <script src="libs/js4shiny-redirectConsoleLog-0.0.28/redirectConsoleLog.js"></script>
    <link href="libs/countdown-0.3.5/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.3.5/countdown.js"></script>
    <script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
    <link rel="stylesheet" href="assets/css/style.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/xaringan-extra.css" type="text/css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/devices.css@0.1.15/dist/devices.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Unleash Shiny
## R/Pharma - Advanced Shiny Workshop
### David Granjon (Novartis) &amp; John Coene (World Economic Forum)
### 13-03-2020

---


&lt;style&gt;
.title-slide {
  background-image: url(assets/img/bg/front_cover.jpg);
  background-size: cover;
}
&lt;/style&gt;





# About us

.flex.tc[
.w-30.mr3[
&lt;img class="br-100" src="assets/img/people/david.jpg" /&gt;
.f5[David]

.small[Data Scientist at Novartis]
.small[RinteRface founder]
.small[Known for: `{shinydashboardPlus}`, `{bs4Dash}` and `{shinyMobile}`]

.gray[&amp;commat;divadnojnarg]
]

.w-30.mr3[
&lt;img class="br-100" src="assets/img/people/john.jpg" /&gt;
.f5[John]

.small[Data scientist at the World Economic Forum]
.small[Known for: `{echarts4r}` and `{waiter}`]

.gray[&amp;commat;jdatap]
]


.w-30.mr3[
&lt;img class="br-100" src="assets/img/people/colin.jpg" /&gt;
.f5[Colin]

.small[Shiny Expert at ThinkR]
.small[Known for: `{golem}`, https://engineering-shiny.org/]

.gray[&amp;commat;_ColinFay]
]
]

---
# Plan

We're in for 4 hours of fun!

- Grab a coffee
- Make yourself comfortable
- Ask questions!  

1. Quick intro on shiny under the hood
2. Custom inputs
3. Pause
4. Custom outputs
5. Q &amp; A

---

# Workshop Material

To reproduce the workshop on your computer, install the following packages:
.f5.w-70.mh-a.mt4.small[
```r
devtools::install_github("RinteRface/charpente", dependencies = TRUE)
devtools::install_github("DivadNojnarg/OSUICode")
```

.tc.mt4[
For a plug and play experience, prefer [Rstudio Cloud](https://rstudio.cloud/)
]
]

---
class: break center middle
background-image: url('assets/img/bg/intro.jpg')
background-size: cover

.center[
&lt;h3 class="white absolute bottom"&gt;Introduction&lt;/h3&gt;
]


---
class: center

# Shiny or not Shiny?
&lt;div class="device device-iphone-8 device-spacegray" style="position: absolute; left: 0; right: 0;
top: 0; bottom: 0; margin: auto; max-width: 100%; max-height: 100%; transform: scale(0.6);"&gt;
&lt;div class="device-frame"&gt;
&lt;iframe width="100%" src="https://shiny.john-coene.com/coronavirus/" allowfullscreen="" frameborder="0" height="100%" scrolling="auto"&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;div class="device-stripe"&gt;&lt;/div&gt;
&lt;div class="device-header"&gt;&lt;/div&gt;
&lt;div class="device-sensors"&gt;&lt;/div&gt;
&lt;div class="device-btns"&gt;&lt;/div&gt;
&lt;div class="device-power"&gt;&lt;/div&gt;
&lt;/div&gt;

---
# Shiny or not Shiny?

&lt;div class="device device-macbook-pro device-spacegray" style="position: absolute; left: 0; right: 0;
top: 0; bottom: 0; margin: auto; max-width: 100%; max-height: 100%; transform: scale(1);"&gt;
&lt;div class="device-frame"&gt;
&lt;iframe width="100%" src="https://themeon.net/nifty/v2.9.1/widgets.html" allowfullscreen="" frameborder="0" height="100%" scrolling="auto"&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;div class="device-stripe"&gt;&lt;/div&gt;
&lt;div class="device-header"&gt;&lt;/div&gt;
&lt;div class="device-sensors"&gt;&lt;/div&gt;
&lt;div class="device-btns"&gt;&lt;/div&gt;
&lt;div class="device-power"&gt;&lt;/div&gt;
&lt;/div&gt;

---

# Shiny or not Shiny?

&lt;div class="device device-macbook-pro device-spacegray" style="position: absolute; left: 0; right: 0;
top: 0; bottom: 0; margin: auto; max-width: 100%; max-height: 100%; transform: scale(1);"&gt;
&lt;div class="device-frame"&gt;
&lt;iframe width="100%" src="https://dgranjon.shinyapps.io/shinyMons/" allowfullscreen="" frameborder="0" height="100%" scrolling="auto"&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;div class="device-stripe"&gt;&lt;/div&gt;
&lt;div class="device-header"&gt;&lt;/div&gt;
&lt;div class="device-sensors"&gt;&lt;/div&gt;
&lt;div class="device-btns"&gt;&lt;/div&gt;
&lt;div class="device-power"&gt;&lt;/div&gt;
&lt;/div&gt;

---

# A simple Shiny app

#### No HTML/CSS/JS and it just works üò®! What kind of **magic** is this?

&lt;iframe src="https://gallery.shinyapps.io/050-kmeans-example" height="400px" width="100%"&gt;&lt;/iframe&gt;


---
&lt;video style="position: fixed;
  right: 0;
  bottom: 0;
  min-width: 100%;
  min-height: 100%;
  width: 100%; "loop="" autoplay="" poster="assets/img/bg/virtual_patient.png"&gt;
&lt;source src="assets/movies/VirtualPatient.mp4" type="video/mp4"&gt;
&lt;/video&gt;

---
class: break center middle
background-image: url('assets/img/bg/part1.jpg')
background-size: cover

&lt;h3 class="white absolute bottom center"&gt;Part 1. Custom Templates with Shiny&lt;/h3&gt;

---
class: header_background
# A. Shiny generates HTML from R
## Warmup 1
1. Run the following code:


```r
p("Hello World")
```

2. Copy and paste this code to the R console. What do you observe?

---
class: header_background
# A.1.1 Introduction to HTML: **tags**
## The simplest HTML skeleton
.pull-left.mh-a[
```html
&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;!-- head content here --&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;!-- body content here --&gt;
  &lt;/body&gt;
&lt;/html&gt;
```
]

.pull-right.small[
There are 2 types of **tags**:
  - paired-tags:`&lt;div&gt;&lt;/div&gt;`
  - self closing tags: `&lt;img/&gt;`
  
We classify them by usage:

  - structural tags: `&lt;head&gt;&lt;/head&gt;`, `&lt;body&gt;&lt;/body&gt;`
  - control tags: `&lt;script&gt;&lt;/script&gt;`, `&lt;button&gt;&lt;/button&gt;`
  - formatting tags: `&lt;font&gt;&lt;/font&gt;`
  
Block vs inline:

  - `&lt;div&gt;&lt;p&gt;Hello World&lt;/p&gt;&lt;/div&gt;`: .green[Good]
  - `&lt;span&gt;&lt;div&gt;&lt;p&gt;Hello World&lt;/p&gt;&lt;/div&gt;&lt;/span&gt;`: .red[not good]
]

---
class: header_background
# A.1.2 Introduction to HTML: **attributes**
## Attributes specify the tags properties
.pull-left.mh-a[
```html
&lt;div class="awesome-item" id="myitem"&gt;&lt;/div&gt;
&lt;!-- the class awesome-item may be applied to multiple tags --&gt;
&lt;span class="awesome-item"&gt;&lt;/span&gt;
```
]


.pull-right[
The most common attributes:
  - **class** may be shared between multiple tags
  - **id** is unique
  - non standards attributes like `data-toggle`
]

Attributes are used by **CSS** and **JavaScript** to **interact** with the web page!

---
class: header_background
# A.2.1 About the Document Object Model
## Visualizing the DOM with the HTML inspector

.pull-left.w-50[
DOM is a convenient representation (tree) of the HTML document. We inspect the code of any web page with Firefox or Chrome:

  - after a right click and selecting inspect
  - after clicking on **F12** (windows), **fn + F12** (Mac)
]

.pull-right.w-50[
&lt;img src="assets/img/html_DOM.png" width="50%" /&gt;
]

--- 
class: header_background
# A.2.2 About the DOM: exercise
## Warmup 2

```r
library(shiny)
ui &lt;- fluidPage(p("Hello World"))
server &lt;- function(input, output) {}
shinyApp(ui, server)
```

1. Run the above app, right click on the only text element and select inspect
2. In the `Elements` panel, double click between the `&lt;p&gt;&lt;/p&gt;` tag to edit the current text. Press enter when finished

---
class: header_background
# B. Discover Shiny dependencies
## Warmup 3

Let's play ‚èØ:

  1. Run the app `runExample("01_hello")`
  2. Open the HTML inspector
  3. Delete the bootstrap.min.css and ion.rangeSlider.css
  4. Conclusions


---
class: header_background
# C. Unleash `{htmltools}` 
`{htmltools}` is a R package designed to:
  - Generate HTML tags from R
  - Handle web dependencies: add, remove, resolve, ...

Historically, `{htmltools}` was extracted out of `{shiny}` to extend it. That's why, both packages
have many common functions! 

At the moment, `{htmltools}` does not have any user guide, although being an important package for all web things
[![](https://cranlogs.r-pkg.org/badges/htmltools)](https://cran.r-project.org/package=htmltools)

---
class: header_background
# C.1.1 Handle dependencies
## How would you include JS/CSS in a Shiny app?

.pull-left.w-30.mh-a.small[
Works but not **portable**

```r
fluidPage(
  tags$head(
    tags$style(...),
    tags$script(src = "path-to-script"),
    tags$script(
      "$(function() {
       // JS logic ...
      });
      "
    )
  )
)
```
]

.pull-right.w-70.mh-a.small[
With `{htmltools}`, we define the dependency, then attach it to a tag with `tagList`:

```r
use_bs4_dep &lt;- function(tag) {
  bs4_dep &lt;- htmlDependency(
    name = "Bootstrap 4",
    version = "1.0",
    src = c(href = "https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/"),
    stylesheet = "bootstrap.min.css"
  )
  tagList(tag, bs4_dep)
}
use_bs4_dep(fluidPage())
```
]

---
class: header_background
# C.1.2 Handle dependencies
## Exercise 1

Open `htmltools_deps.Rmd` and complete exercise 1

<div class="countdown" id="timer_5f6f3eb7" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: header_background
# C.2.1 From HTML to R üßô‚Äç‚ôÇÔ∏è
## HTML VS R
.pull-left.w-50.mh-a[
In HTML, we have:
```html
&lt;div class="divclass" id = "daddy"&gt;
  &lt;h1&gt;A child&lt;/h1&gt;
  &lt;span class="child" id="baby"&gt;Crying&lt;/span&gt;
&lt;/div&gt;
```
]

.pull-right.w-50.mh-a[
The corresponding R code is 


```r
mytag &lt;- div(
  class = "divclass",
  id = "daddy",
  h1("A child"),
  span(class = "child", id = "baby", "Crying")
)
```
]

Some tags like `&lt;nav&gt;&lt;/nav&gt;` need the `tags$` prefix before (`tags` is a list of functions). The `withTags` function to use `tags$&lt;tagName&gt;`


---
class: header_background
# C.2.2 Automate the conversion? 
.center[
&lt;img src="assets/img/thug_life.png" width="10%" /&gt;
]

This process is not interesting and time consuming! Tools exist:

  - html2R [Shiny app](https://alandipert.shinyapps.io/html2r/) converts HTML to R (thanks Alan Dipert)
  - `{charpente}` does the same from the R console with `html_2_R` 
  
.small[

```r
html_2_R('&lt;div class="divclass" id = "daddy"&gt;&lt;/div&gt;')
```

```
## div(
##   class = "divclass",
##   id = "daddy"
## )
```
]


---
class: header_background
# C.2.3 Accessing R tags attributes
How to access name, attributes, children?

We could use `str(mytag)` to inspect the structure of the R object.

.small[

```r
mytag$attribs 
```

```
## $class
## [1] "divclass"
## 
## $id
## [1] "daddy"
```

```r
mytag$children 
```

```
## [[1]]
## &lt;h1&gt;A child&lt;/h1&gt;
## 
## [[2]]
## &lt;span class="child" id="baby"&gt;Crying&lt;/span&gt;
```
]

---
class: header_background
# C.2.4 Manipulate R tags
## Add new attributes
There are 2 methods:
 - `tagAppendAttributes(tag, list of attributes)` is preferred
 -`tag$attribs[["new-attribute"]] &lt;- value`

## Add child/children
`tagAppendChild(tag, child)`, `tagAppendChildren(tag, list of children)`

There exist other functions but we'll not use them.


---
class: header_background
# C.2.4 Programmatically create children elements
Let's create 5 `span` tags:

.pull-left.w-70.mh-a[
```r
div(
  span(1),
  span(2),
  span(3),
  span(4),
  span(5)
)
```

What about 100 tags üò±?

]

.pull-right.w-70.mh-a[
Let's do some functional programming!
```r
# base R
div(lapply(1:5, function(i) span(i)))
# purrr + %&gt;%
map(1:5, function(i) span(i)) %&gt;% div()
```
]


---
class: header_background
# C.2.4 Wrap up
## Exercise 2

Open `htmltools_HTML_to_R.Rmd` and complete exercise 1 and 2

<div class="countdown" id="timer_5f6f3f46" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---
class: header_background
# D. Practice: bulma
In the following, you'll reconstruct the `{shinyBulma}` package step by step!
.center[
&lt;img src="assets/img/shinybulma.svg" width="20%" /&gt;
]

Main tasks:
  - Import [bulma](https://bulma.io/) dependencies
  - Generate the main `page` function 
  
Lets' start! Open `shinyBulma.Rmd` and enjoy üêí

---
class: break center middle
background-image: url('assets/img/bg/part2.jpg')
background-size: cover

&lt;h3 class="white absolute bottom center"&gt;Part 2. Unleash Shiny's Interactivity &lt;/h3&gt;

---
class: header_background
# A.1 Inputs are key to interactivity
.pull-left.w-50.mh-a.mt4[
**Inputs** are key elements of web applications. They drive user interactions like:

  - configure parameters
  - fill and submit a form
  - ...

&lt;br&gt;

`{shiny}` brings various inputs like `sliderInput`, `numericInput`, ...
  
]

.pull-right.w-50.mt4[
&lt;div class="device device-iphone-8 device-spacegray" style="position: absolute; left: 50;
top: 50; bottom: 0; margin: auto; max-width: 100%; max-height: 100%; transform: scale(0.6);"&gt;
&lt;div class="device-frame"&gt;
&lt;iframe width="100%" src="https://gallery.shinyapps.io/081-widgets-gallery" allowfullscreen="" frameborder="0" height="100%" scrolling="auto"&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;div class="device-stripe"&gt;&lt;/div&gt;
&lt;div class="device-header"&gt;&lt;/div&gt;
&lt;div class="device-sensors"&gt;&lt;/div&gt;
&lt;div class="device-btns"&gt;&lt;/div&gt;
&lt;div class="device-power"&gt;&lt;/div&gt;
&lt;/div&gt;
]

&lt;br&gt;

.center[
How does all this even work üßö?
]

---
class: header_background
# A.2 Shiny heavily relies on JavaScript (JS)
.pull-left.w-50.mt4[
JS source may be found [here](https://github.com/rstudio/shiny/tree/master/srcjs).
In short all these files are **concatenated** to create one very big `shiny.js` responsible for:

  - registering input/output
  - handling every single input/output action
  - initializing and controlling the **websocket** üß¶ (the whaaaat?)
  - handling alerts/modals/notifications
  - ...

.center[
&lt;img src="assets/img/shiny-input-homer.gif" width="25%" /&gt;
]
  
]

.pull-right.w-50.mt4[
&lt;img src="assets/img/shiny-js-sources.png" width="100%" /&gt;
]

---
class: header_background
# A.3.1 R and JS
Let's consider the following app
.pull-left.w-50.small[
```r
ui &lt;- fluidPage(
  textInput("text", "My text", "Some text"),
  actionButton("update", "Update")
)

server &lt;- function(input, output, session) {
  observeEvent(input$update, {
    updateTextInput(session, "text", value = "Updated text")
  })
}

shinyApp(ui, server)
```
]

.pull-right.w-50[
Waiiit!!

  - How does JS knows that R wants to update the text value ‚ùì 
  - How does Shiny knows when to send back the updated text to R ‚ùì
]

---
class: header_background
# A.3.2 The websocket
This is the magic piece allowing **bidirectional** communication between R and JavaScript. The technology behind is provided by `{httpuv}` and `{websocket}`.

.pull-left.w-50[
1. Run the previous app
2. Open the HTML inspector
3. Select the `Network` tab
4. Search for websocket
5. Play with the app and observe!
]

.pull-right.w-50[
&lt;img src="assets/img/inspect-websocket.png" width="100%" /&gt;
]

---
class: header_background
# A.3.3 From R to JS
On the R side, we have the `session` magic. `session` is actually an instance of the `ShinySession` R6 class. It has several methods like:
  - `sendCustomMessage` send R messages to JS
  - `sendInputMessage` send R messages to **input bindings**
  
&lt;br&gt;
  
`updateTextInput` is a customized `session$sendInputMessage`:

.small[
```r
updateTextInput &lt;- function (session, inputId, label = NULL, value = NULL) 
{
    message &lt;- dropNulls(list(label = label, value = value))
    session$sendInputMessage(inputId, message)
}
```
]

---
class: header_background
# A.3.4 From JS to R
`Shiny` is also a JavaScript object! 

.pull-left.w-50.small[
Run this app and open the HTML inspector

```r
ui &lt;- fluidPage(
  tags$script(
    "$(function() {
      console.log(Shiny);
    });
    "
  )
)
server &lt;- function(input, output) {}
shinyApp(ui, server)
```

]

.pull-right.w-50[
&lt;img src="assets/img/shiny-object.png" width="90%" /&gt;
]

`Shiny.addCustomMessageHandler` is the JS part of `session$sendCustomMessage`.
For Shiny inputs, it is slightly more complex üëø!

---
class: header_background
# A.4 Bulma JS for Shiny
In this part you'll need to fork the `{shinybulma}` [repository](https://github.com/RinteRface/shinybulma) and work on the `bulma-js` branch. We split the audience in 4 groups (1 instructor per group). Each group will choose between:

  - Notifications, doc [here](https://bulmajs.tomerbe.co.uk/docs/0.11/2-core-components/notification/)
  - Modal, doc [here](https://bulmajs.tomerbe.co.uk/docs/0.11/2-core-components/modal/)
  
John and I will review the PR after the workshop!

<div class="countdown" id="timer_5f6f4094" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">20</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---
class: header_background
# B.1.1 The Shiny input system
## Input tag structure
Input tags have various HTML structure.

```html
&lt;input id = inputId type = "text" class = "input-text" value = value&gt;
```

The simplest is probably the text input:

 - **id** guarantees the input **uniqueness**. We will see very soon that all instances of the same input share a unique **input binding**, therefore id is mandatory
 - **type** define the input type
 - **class** is generally targeted by JavaScript
 - **value** holds the input value

---
class: header_background
# B.1.2 The Shiny input system
## Binding Shiny inputs
An input binding: 
 - Allows Shiny to **identify** each **instance** of a given input 
 - Describes what you may do with it. For instance, a slider input must **update** whenever the range is dragged or when the left and right arrows of the keyboard are pressed. 
 - **Receives messages** from R ...
 - ... tells **when** Shiny have to update the value for R
 
üóí Bindings rely on a JS class defined in the input_binding.js [file](https://github.com/rstudio/shiny/blob/master/srcjs/input_binding.js)

In the following, we'll need `devtools::install_github("DivadNojnarg/OSUICode")`

---
class: header_background
# B.2.1 The binding steps: **find**
The idea is to **locate** the input in the DOM. 

.pull-left.w-50.small[
We generally filter by **class**, **scope** being the **document**.

```js
find: function(scope) {
  console.log($(scope).find('.input-text'));
  return $(scope).find('.input-text');
}
```

Run the following and open the HTML inspector.

```r
library(OSUICode)
customTextInputExample(1)
```
]

.pull-right.w-50[
&lt;img src="assets/img/shiny-find-inputs.png" width="100%" /&gt;
]

---
class: header_background
# B.2.2 The binding steps: **initialize**
Upon app initialization, Shiny calls the `initializeInputs` function that takes all input bindings and call their **initialize** method. This is useful if you work with "sophisticated " API like [Framework7](https://framework7.io/). We won't have time to cover this topic here...

---
class: header_background
# B.2.3 The binding steps: **get the value**
This step ensures that R **gets** the input **value** at any time. The jQuery `val` method allows to get the current value.

.pull-left.w-50[
```js
getValue: function(el) {
  return $(el).val();
}
```
]

.pull-right.w-50[
1. Run the following and open the HTML inspector
2. Update the text content
3. What happens? Why?

```r
customTextInputExample(2)
```
]

---
class: header_background
# B.2.4 The binding steps: **set and update**
.small[
`setValue(el, value)` is used to set the input value. It called within `receiveMessage(el, data)`, which is the JS part of all the R `updateInput` functions.
]

.pull-left.w-50.small[
```js
setValue: function(el, value) {
  $(el).val(value);
}

receiveMessage: function(el, data) {
  console.log(data);
  if (data.hasOwnProperty('value')) {
    this.setValue(el, data.value);
  }
  // other parameters to update...
}
```

Run the following and open the HTML inspector. Why doesn't the output value change?

```r
updateCustomTextInputExample(3)
```
]

.pull-right.w-50[
&lt;img src="assets/img/shiny-update-inputs.png" width="100%" /&gt;
]

---
class: header_background
# B.2.5 The binding steps: **subscribe**

.pull-left.w-70.small.mt2[
`subscribe(el, callback)` **listens** to **events** defining Shiny to update the input value and make it available in the app. For a text input, we might have:

```js
subscribe: function(el, callback) {
  // when updated
  $(el).on('change.customTextBinding', function(event) {
    callback(false);
  });
  
  // keyboard, copy and paste, ...
  $(el).on('keyup.customTextBinding input.customTextBinding', function(event) {
    callback(true);
  });
}
```
]

.pull-right.w-30.small.mt2[
Run the following demonstration.
```r
updateCustomTextInputExample(4)
updateCustomTextInputExample(5)
```
]

**callback()** tells to update the input on the server (R). If true, a **rate policy** is applied!

---
class: header_background
# B.2.6 The binding steps: **rate policies**
As mentioned before, `callback(true)` will set rate policy for the given **event listener**. Setting a rate policy is relevant when we don‚Äôt want to flood the server with tons of update requests.

.pull-left.w-50.small[
```js
getRatePolicy: function() {
  return {
    // Can be 'debounce' or 'throttle'
    policy: 'debounce',
    delay: 500
  };
}
```
]

.pull-right.w-50.small[
Below, the text input only updates after releasing the keyboard for 250ms.

```r
updateCustomTextInputExample(6)
```
]

---
class: header_background center
# B.2.7 The binding steps: Recap

.mt-50[
&lt;video width="80%" style="margin-top: 25px;"&gt;
&lt;source src="assets/movies/input-binding-steps.mov" type="video/mp4"&gt;
&lt;/video&gt;
]


---
class: header_background
# B.3 Box on Steroids!
.mt-4[
Boxes are a center element of `{shinydashboard}`. Yet the latter only exploit 10% of their
capability. Your mission: unleash the AdminLTE API to deliver box on steroids!
]


<div class="countdown" id="timer_5f6f417d" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">20</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: break center middle
background-image: url('assets/img/bg/part3.jpg')
background-size: cover

&lt;h3 class="white absolute bottom center"&gt;Part 3. Custom Outputs&lt;/h3&gt;

---
class: header_background
# A. Multi page applications üìÑ üìÉ üìÉ

"Traditional" applications and websites

.pull-left.w-70.mh-a[
<div id="htmlwidget-308845f8c1869797e388" style="width:100%;height:432px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-308845f8c1869797e388">{"x":{"diagram":"\nstrict digraph{\n  graph[rankdir=LR fontsize = 10]\n  node [shape=record fontsize=10];\n  s [label=\"Server\" color=cornflowerBlue];\n  c [label=\"Client\" color=gold];\n  c -> s [color=dimGray arrowsize=.3 label=request fontsize = 9];\n  s -> c [color=dimGray arrowsize=.3 label=response fontsize = 9];\n\n  c1 [label=\"Client\" color=gold];\n  c1 -> s [color=dimGray arrowsize=.3 label=request fontsize = 9];\n  s -> c1 [color=dimGray arrowsize=.3 label=response fontsize = 9];\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
]

.pull-right.w-70.mh-a[
  ### HTTP 1.1

  _A new page is requested_

  - Client requests `/`, server responds
  - Client requests `/about`, server gives a different response
  - Client requests `/products`, server gives a yet a different response
  - and so on
]

---
class: header_background
# A.1.1 Single page applications üìÉ

A more recent web development.

.pull-left.w-70.mh-a[
<div id="htmlwidget-d9efc296029384a345c1" style="width:100%;height:432px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-d9efc296029384a345c1">{"x":{"diagram":"\ndigraph{\n  graph[rankdir=LR fontsize = 10]\n  node [shape=record fontsize=10];\n  s [label=\"Server\" color=cornflowerBlue];\n  c1 [label=\"Client\" color=gold];\n  c2 [label=\"Client\" color=gold];\n  c3 [label=\"Client\" color=gold];\n  c1 -> s [dir=both color=dimGray arrowsize=.3 label=messages fontsize = 9];\n  c2 -> s [dir=both color=dimGray arrowsize=.3 label=messages fontsize = 9];\n  c3 -> s [dir=both color=dimGray arrowsize=.3 label=messages fontsize = 9];\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
]

.pull-right.w-70.mh-a[
  ### Websocket

  _Bi-directional communication_

  1. Client connects
  2. Client sends message
  3. Server (may) respond with another message
  4. Back to point 2
]

---
class: header_background
# A.1.2 What about shiny?

So which one of those does shiny use?

&gt; Both!

But one (probably) more than the other...

When you visit a shiny app: 

1. Your browser makes an HTTP request to the shiny `server` which responds with the initial `ui`.
2. All subsequent communication is done via websocket (`input`, `output`).

_(no other `/page` is ever visited)_

---
class: header_background
# A.1.3 Serving an HTTP response

Shiny allows publishing any R object as a URL endpoint _unique to the session._

.pull-left-70[

```r
session$registerDataObj(
  "cars-data",            # endpoint 
  cars,                   # data
  function(data, req) {
    res &lt;- jsonlite::toJSON(cars)
    shiny:::httpResponse(
      200L,               # status
      "application/json", # header 
      res                 # response
    )
  }
)
```

]

.pull-right-30[
```json
[
  {
    "speed": 4,
    "dist": 2
  },
  {
    "speed": 4,
    "dist": 10
  }
]
```
]

---
class: header_background
# A.1.3 Serving an HTTP response

&lt;div class="confusing"&gt;
&lt;h1 class="confusing-text"&gt;Too complicated!&lt;/h1&gt;
&lt;/div&gt;

Shiny allows publishing any R object as a URL endpoint _unique to the session._

.pull-left-70[

```r
session$registerDataObj(
  "cars-data",            # endpoint 
  cars,                   # data
  function(data, req) {
    res &lt;- jsonlite::toJSON(cars)
    shiny:::httpResponse(
      200L,               # status
      "application/json", # header 
      res                 # response
    )
  }
)
```

]

.pull-right-30[
```json
[
  {
    "speed": 4,
    "dist": 2
  },
  {
    "speed": 4,
    "dist": 10
  }
]
```
]

---
class: break center middle
background-image: url('https://rstudio.com/assets/img/og/rstudio-og-fb-1.jpg')
background-size: cover

&lt;h3 class="white n rstudio"&gt;Intermission&lt;/h3&gt;
&lt;p class="rstudio-comment"&gt;Open &lt;code&gt;http-intro.R&lt;/code&gt;&lt;/p&gt;

---
class: break center middle
background-image: url('assets/img/bg/part4.jpg')
background-size: cover

&lt;h3 class="white absolute bottom center"&gt;Part 4. Shiny's Hidden Gems&lt;/h3&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "docco",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<script>
  (function (d) {
    d.addEventListener('DOMContentLoaded', function () {
      // find code chunks that get special colors
      const langSpecial = ['r', 'js', 'yaml', 'json', 'bash', 'html', 'css']
      const codeSpecial = d.querySelectorAll(langSpecial.map(l => 'pre code.' + l))

      // find code chunks with highlighted lines
      const hlines = d.querySelectorAll('.remark-code-line-highlighted')
      const preHLParents = []

      const findPreParent = function (line, p = 0) {
        if (p > 1) return null // traverse up no further than grandparent
        const el = line.parentElement
        if (el.tagName === 'PRE') {
          return el
        } else {
          return findPreParent(el, ++p)
        }
      }

      // add the code language to the parent <pre> element
      for (const code of codeSpecial) {
        const pre = findPreParent(code)
        const codeLang = code.className.split(' ').filter(c => langSpecial.includes(c))
        pre.classList += ` ${codeLang}`
      }

      // add remark-code-has-line-highlighted to parent <pre> element
      for (const line of hlines) {
        const pre = findPreParent(line)
        if (pre && !preHLParents.includes(pre)) preHLParents.push(pre)
      }
      preHLParents.forEach(p => p.classList += ' remark-code-has-line-highlighted')

      slideshow.on('afterShowSlide', function (slide) {
        replaceIframePlaceholders()
      })

      replaceIframePlaceholders()
    })
  })(document)

function replaceIframePlaceholders () {
  document
  .querySelectorAll('.remark-slides-area .remark-visible div[data-iframe]')
  .forEach(el => replaceIframePlaceholder(el))
}

function replaceIframePlaceholder (el) {
  const iframe = document.createElement('iframe')
  if (el.childNodes) {
    el.childNodes.forEach(e => iframe.appendChild(e))
  }
  iframe.src = el.dataset.src
  iframe.classList = el.classList
  el.parentElement.replaceChild(iframe, el)
}
</script>
  <style>
  .remark-code-has-line-highlighted .remark-code-line:not(.remark-code-line-highlighted) {
    opacity: 0.4;
  }

.remark-code-line-highlighted {
  background-color: inherit; /* Override highlight color */
    /* font-weight: 500; */
}

/* Line Hover Indicator */
  .remark-code-line:hover {
    font-weight: bold;
    opacity: 1 !important;
  }

.remark-code-line:hover:before {
  content: "\25B6";
  color: #6d7e8a;
    position: absolute;
  transform: translateX(-1.2em);
  animation: hover 0.66s alternate 8 cubic-bezier(0.445, 0.05, 0.55, 0.95);
}

@keyframes hover {
  0% {
    transform: translateX(-1.2em);
  }
  100% {
    transform: translateX(-0.8em);
  }
}
</style>
<script type='text/javascript'>

var slideElements

  function getElementForSlide(slide) {
    slideElements = slideElements || document.querySelectorAll('.remark-slide')
    return slideElements[slide.getSlideIndex()]
  }

  slideshow.on('showSlide', function (slide) {
    Array.from(getElementForSlide(slide).querySelectorAll('video, audio')).forEach(function (vid) {
      vid.loop = false
      vid.currentTime = 0
      vid.play()
    })
  })

  slideshow.on('hideSlide', function (slide) {
    Array.from(getElementForSlide(slide).querySelectorAll('video, audio')).forEach(function (vid) {
      vid.pause()
    })
  })

</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'FALSE';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
